/**
 * Copyright (C) 2010-2012 Graham Breach
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 * 
 * You should have received a copy of the GNU Lesser General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
/**
 * jQuery.tagcanvas 1.16
 * For more information, please contact <graham@goat1000.com>
 */
(function(H){var Q,P,F=Math.abs,q=Math.sin,g=Math.cos,y=Math.max,U=Math.min,A={},B={},C={0:"0,",1:"17,",2:"34,",3:"51,",4:"68,",5:"85,",6:"102,",7:"119,",8:"136,",9:"153,",a:"170,",A:"170,",b:"187,",B:"187,",c:"204,",C:"204,",d:"221,",D:"221,",e:"238,",E:"238,",f:"255,",F:"255,"},d,I,c,k=document,x;for(Q=0;Q<256;++Q){P=Q.toString(16);if(Q<16){P="0"+P}B[P]=B[P.toUpperCase()]=Q.toString()+","}function M(i){return typeof(i)!="undefined"}function G(j){var X=j.length-1,W,Y;while(X){Y=~~(Math.random()*X);W=j[X];j[X]=j[Y];j[Y]=W;--X}}function m(X,Z,ae,ab){var aa,ad,j,ac,af=[],Y=Math.PI*(3-Math.sqrt(5)),W=2/X;for(aa=0;aa<X;++aa){ad=aa*W-1+(W/2);j=Math.sqrt(1-ad*ad);ac=aa*Y;af.push([g(ac)*j*Z,ad*ae,q(ac)*j*ab])}return af}function T(Y,W,ab,ah,ag,ae,ad,ac,aa){var af,ai=[],Z=Math.PI*(3-Math.sqrt(5)),X=2/Y;for(ae=0;ae<Y;++ae){ad=ae*X-1+(X/2);af=ae*Z;ac=g(af);aa=q(af);ai.push(W?[ad*ab,ac*ah,aa*ag]:[ac*ab,ad*ah,aa*ag])}return ai}function v(X,i,j,W){return T(X,0,i,j,W)}function E(X,i,j,W){return T(X,1,i,j,W)}function o(Z,i){var Y=Z,X,W,j=(i*1).toPrecision(3)+")";if(Z[0]==="#"){if(!A[Z]){if(Z.length===4){A[Z]="rgba("+C[Z[1]]+C[Z[2]]+C[Z[3]]}else{A[Z]="rgba("+B[Z.substr(1,2)]+B[Z.substr(3,2)]+B[Z.substr(5,2)]}}Y=A[Z]+j}else{if(Z.substr(0,4)==="rgb("||Z.substr(0,4)==="hsl("){Y=(Z.replace("(","a(").replace(")",","+j))}else{if(Z.substr(0,5)==="rgba("||Z.substr(0,5)==="hsla("){X=Z.lastIndexOf(",")+1,W=Z.indexOf(")");i*=parseFloat(Z.substring(X,W));Y=Z.substr(0,X)+i.toPrecision(3)+")"}}}return Y}function f(i,j){if(window.G_vmlCanvasManager){return null}var W=k.createElement("canvas");W.width=i;W.height=j;return W}function u(){var j=f(3,3),X,W;if(!j){return false}X=j.getContext("2d");X.strokeStyle="#000";X.shadowColor="#fff";X.shadowBlur=3;X.globalAlpha=0;X.strokeRect(2,2,2,2);X.globalAlpha=1;W=X.getImageData(2,2,1,1);j=null;return(W.data[0]>0)}function V(ad,j){var W=1024,Z=ad.weightGradient,Y,ab,X,ac,aa;if(ad.gCanvas){ab=ad.gCanvas.getContext("2d")}else{ad.gCanvas=Y=f(W,1);if(!Y){return null}ab=Y.getContext("2d");ac=ab.createLinearGradient(0,0,W,0);for(X in Z){ac.addColorStop(1-X,Z[X])}ab.fillStyle=ac;ab.fillRect(0,0,W,1)}aa=ab.getImageData(~~((W-1)*j),0,1,1).data;return"rgba("+aa[0]+","+aa[1]+","+aa[2]+","+(aa[3]/255)+")"}function t(Z,Y,W,ac,aa,ab,j){var X=(ab||0)+(j&&j[0]<0?F(j[0]):0),i=(ab||0)+(j&&j[1]<0?F(j[1]):0);Z.font=Y;Z.textBaseline="top";Z.fillStyle=W;aa&&(Z.shadowColor=aa);ab&&(Z.shadowBlur=ab);j&&(Z.shadowOffsetX=j[0],Z.shadowOffsetY=j[1]);Z.fillText(ac,X,i)}function l(ai,aa,ae,ag,Z,W,ac,ad,j,ah,af){var X=ag+F(j[0])+ad+ad,i=Z+F(j[1])+ad+ad,Y,ab;Y=f(X+ah,i+af);if(!Y){return null}ab=Y.getContext("2d");t(ab,aa,W,ai,ac,ad,j);return Y}function O(aa,ad,ae,X){var Y=aa.width+F(X[0])+ae+ae,j=aa.height+F(X[1])+ae+ae,ab,ac,Z=(ae||0)+(X&&X[0]<0?F(X[0]):0),W=(ae||0)+(X&&X[1]<0?F(X[1]):0);ab=f(Y,j);if(!ab){return null}ac=ab.getContext("2d");ad&&(ac.shadowColor=ad);ae&&(ac.shadowBlur=ae);X&&(ac.shadowOffsetX=X[0],ac.shadowOffsetY=X[1]);ac.drawImage(aa,Z,W);return ab}function J(ai,aa,ag){var ah=parseInt(ai.length*ag),Z=parseInt(ag*2),X=f(ah,Z),ad,j,Y,ac,af,ae,W,ab;if(!X){return null}ad=X.getContext("2d");ad.fillStyle="#000";ad.fillRect(0,0,ah,Z);t(ad,ag+"px "+aa,"#fff",ai);j=ad.getImageData(0,0,ah,Z);Y=j.width;ac=j.height;ab={min:{x:Y,y:ac},max:{x:-1,y:-1}};for(ae=0;ae<ac;++ae){for(af=0;af<Y;++af){W=(ae*Y+af)*4;if(j.data[W+1]>0){if(af<ab.min.x){ab.min.x=af}if(af>ab.max.x){ab.max.x=af}if(ae<ab.min.y){ab.min.y=ae}if(ae>ab.max.y){ab.max.y=ae}}}}if(Y!=ah){ab.min.x*=(ah/Y);ab.max.x*=(ah/Y)}if(ac!=Z){ab.min.y*=(ah/ac);ab.max.y*=(ah/ac)}X=null;return ab}function s(i){return"'"+i.replace(/(\'|\")/g,"").replace(/\s*,\s*/g,"', '")+"'"}function z(i,j,W){W=W||k;if(W.addEventListener){W.addEventListener(i,j,false)}else{W.attachEvent("on"+i,j)}}function N(Y,aa,X,j){var W=j.taglist,Z=j.imageScale;if(Z&&!(aa.width&&aa.height)){z("load",function(){N(Y,aa,X,j)},window);return}if(Y.complete){if(Z){Y.width=aa.width*Z;Y.height=aa.height*Z}X.w=Y.width;X.h=Y.height;W.push(X)}else{z("load",function(){if(Z){this.width=aa.width*Z;this.height=aa.height*Z}X.w=this.width;X.h=this.height;W.push(X)},Y)}}function L(X,W){var j=k.defaultView,i=W.replace(/\-([a-z])/g,function(Y){return Y.charAt(1).toUpperCase()});return(j&&j.getComputedStyle&&j.getComputedStyle(X,null).getPropertyValue(W))||(X.currentStyle&&X.currentStyle[i])}function w(W,j){var i=1,X;if(W.weightFrom){i=1*(j.getAttribute(W.weightFrom)||W.textHeight)}else{if(X=L(j,"font-size")){i=(X.indexOf("px")>-1&&X.replace("px","")*1)||(X.indexOf("pt")>-1&&X.replace("pt","")*1.25)||X*3.3}else{W.weight=false}}return i}function h(W){K(W);var j=W.target||W.fromElement.parentNode,i=r.tc[j.id];i&&(i.mx=i.my=-1)}function K(Y){var X,W,j=k.documentElement,Z;for(X in r.tc){W=r.tc[X];if(W.tttimer){clearTimeout(W.tttimer);W.tttimer=null}Z=H(W.canvas).offset();if(Y.pageX){W.mx=Y.pageX-Z.left;W.my=Y.pageY-Z.top}else{W.mx=Y.clientX+(j.scrollLeft||k.body.scrollLeft)-Z.left;W.my=Y.clientY+(j.scrollTop||k.body.scrollTop)-Z.top}}}function p(X){var j=r,i=k.addEventListener?0:1,W=X.target&&M(X.target.id)?X.target.id:X.srcElement.parentNode.id;if(W&&X.button==i&&j.tc[W]){K(X);j.tc[W].Clicked(X)}}function S(W){var i=r,j=W.target&&M(W.target.id)?W.target.id:W.srcElement.parentNode.id;if(j&&i.tc[j]){W.cancelBubble=true;W.returnValue=false;W.preventDefault&&W.preventDefault();i.tc[j].Wheel((W.wheelDelta||W.detail)>0)}}function n(){var W=r.tc,j;for(j in W){W[j].Draw()}}function b(W,i){var j=q(i),X=g(i);return{x:W.x,y:(W.y*X)+(W.z*j),z:(W.y*-j)+(W.z*X)}}function a(W,i){var j=q(i),X=g(i);return{x:(W.x*X)+(W.z*-j),y:W.y,z:(W.x*j)+(W.z*X)}}function R(W,ad,ac,Y,ab,Z){var i,X,aa,j=W.z1/(W.z1+W.z2+ad.z);i=ad.y*j*Z;X=ad.x*j*ab;aa=W.z2+ad.z;return{x:X,y:i,z:aa}}function e(i){this.ts=new Date().valueOf();this.tc=i;this.x=this.y=this.w=this.h=this.sc=1;this.z=0;this.Draw=i.pulsateTo<1&&i.outlineMethod!="colour"?this.DrawPulsate:this.DrawSimple;this.SetMethod(i.outlineMethod)}d=e.prototype;d.SetMethod=function(W){var j={block:["PreDraw","DrawBlock"],colour:["PreDraw","DrawColour"],outline:["PostDraw","DrawOutline"],classic:["LastDraw","DrawOutline"],none:["LastDraw"]},i=j[W]||j.outline;if(W=="none"){this.Draw=function(){return 1}}else{this.drawFunc=this[i[1]]}this[i[0]]=this.Draw};d.Update=function(ac,ab,ad,Z,aa,j,Y,i){var W=this.tc.outlineOffset,X=2*W;this.x=aa*ac+Y-W;this.y=aa*ab+i-W;this.w=aa*ad+X;this.h=aa*Z+X;this.sc=aa;this.z=j.z};d.DrawOutline=function(Z,i,Y,j,W,X){Z.strokeStyle=X;Z.strokeRect(i,Y,j,W)};d.DrawColour=function(X,aa,Y,ab,W,i,ac,j,Z){return this[ac.image?"DrawColourImage":"DrawColourText"](X,aa,Y,ab,W,i,ac,j,Z)};d.DrawColourText=function(Y,ab,Z,ac,W,i,ad,j,aa){var X=ad.colour;ad.colour=i;ad.Draw(Y,j,aa);ad.colour=X;return 1};d.DrawColourImage=function(ab,ae,ac,af,aa,i,ai,j,ad){var ag=ab.canvas,Y=~~y(ae,0),X=~~y(ac,0),Z=U(ag.width-Y,af)+0.5|0,ah=U(ag.height-X,aa)+0.5|0,W;if(x){x.width=Z,x.height=ah}else{x=f(Z,ah)}if(!x){return this.SetMethod("outline")}W=x.getContext("2d");W.drawImage(ag,Y,X,Z,ah,0,0,Z,ah);ab.clearRect(Y,X,Z,ah);ai.Draw(ab,j,ad);ab.setTransform(1,0,0,1,0,0);ab.save();ab.beginPath();ab.rect(Y,X,Z,ah);ab.clip();ab.globalCompositeOperation="source-in";ab.fillStyle=i;ab.fillRect(Y,X,Z,ah);ab.restore();ab.globalCompositeOperation="destination-over";ab.drawImage(x,0,0,Z,ah,Y,X,Z,ah);ab.globalCompositeOperation="source-over";return 1};d.DrawBlock=function(Z,i,Y,j,W,X){Z.fillStyle=X;Z.fillRect(i,Y,j,W)};d.DrawSimple=function(Y,i,j,X){var W=this.tc;Y.setTransform(1,0,0,1,0,0);Y.strokeStyle=W.outlineColour;Y.lineWidth=W.outlineThickness;Y.shadowBlur=Y.shadowOffsetX=Y.shadowOffsetY=0;Y.globalAlpha=1;return this.drawFunc(Y,this.x,this.y,this.w,this.h,W.outlineColour,i,j,X)};d.DrawPulsate=function(Z,i,j,X){var Y=new Date().valueOf()-this.ts,W=this.tc;Z.setTransform(1,0,0,1,0,0);Z.strokeStyle=W.outlineColour;Z.lineWidth=W.outlineThickness;Z.shadowBlur=Z.shadowOffsetX=Z.shadowOffsetY=0;Z.globalAlpha=W.pulsateTo+((1-W.pulsateTo)*(0.5+(g(2*Math.PI*Y/(1000*W.pulsateTime))/2)));return this.drawFunc(Z,this.x,this.y,this.w,this.h,W.outlineColour,i,j,X)};d.Active=function(W,i,j){return(i>=this.x&&j>=this.y&&i<=this.x+this.w&&j<=this.y+this.h)};d.PreDraw=d.PostDraw=d.LastDraw=function(){};function D(Y,j,ac,ae,ad,aa,W,X){var ab=Y.ctxt,Z;this.tc=Y;this.image=j.src?j:null;this.name=j.src?"":j;this.title=ac.title||null;this.a=ac;this.p3d={x:ae[0]*Y.radius*1.1,y:ae[1]*Y.radius*1.1,z:ae[2]*Y.radius*1.1};this.x=this.y=0;this.w=ad;this.h=aa;this.colour=W||Y.textColour;this.textFont=X||Y.textFont;this.weight=this.sc=this.alpha=1;this.weighted=!Y.weight;this.outline=new e(Y);if(this.image){if(Y.txtOpt&&Y.shadow){Z=O(this.image,Y.shadow,Y.shadowBlur,Y.shadowOffset);if(Z){this.image=Z;this.w=Z.width;this.h=Z.height}}}else{this.textHeight=Y.textHeight;this.extents=J(this.name,this.textFont,this.textHeight);this.Measure(ab,Y)}this.SetShadowColour=Y.shadowAlpha?this.SetShadowColourAlpha:this.SetShadowColourFixed;this.SetDraw(Y)}I=D.prototype;I.SetDraw=function(i){this.Draw=this.image?(i.ie>7?this.DrawImageIE:this.DrawImage):this.DrawText;i.noSelect&&(this.CheckActive=function(){})};I.Measure=function(aa,j){this.h=this.extents?this.extents.max.y+this.extents.min.y:this.textHeight;aa.font=this.font=this.textHeight+"px "+this.textFont;this.w=aa.measureText(this.name).width;if(j.txtOpt){var X=j.txtScale,Y=X*this.textHeight,Z=Y+"px "+this.textFont,W=[X*j.shadowOffset[0],X*j.shadowOffset[1]],i;aa.font=Z;i=aa.measureText(this.name).width;this.image=l(this.name,Z,Y,i,X*this.h,this.colour,j.shadow,X*j.shadowBlur,W,X,X);if(this.image){this.w=this.image.width/X;this.h=this.image.height/X}this.SetDraw(j);j.txtOpt=this.image}};I.SetWeight=function(i){if(!this.name.length){return}this.weight=i;this.Weight(this.tc.ctxt,this.tc);this.Measure(this.tc.ctxt,this.tc)};I.Weight=function(X,W){var j=this.weight,i=W.weightMode;this.weighted=true;if(i=="colour"||i=="both"){this.colour=V(W,(j-W.min_weight)/(W.max_weight-W.min_weight))}if(i=="size"||i=="both"){this.textHeight=j*W.weightSize}this.extents=J(this.name,this.textFont,this.textHeight)};I.SetShadowColourFixed=function(W,j,i){W.shadowColor=j};I.SetShadowColourAlpha=function(W,j,i){W.shadowColor=o(j,i)};I.DrawText=function(W,aa,j){var ab=this.tc,Y=this.x,X=this.y,Z,i,ac=this.sc;W.globalAlpha=this.alpha;W.setTransform(ac,0,0,ac,0,0);W.fillStyle=this.colour;ab.shadow&&this.SetShadowColour(W,ab.shadow,this.alpha);W.font=this.font;Z=this.w;i=this.h;Y+=(aa/ac)-(Z/2);X+=(j/ac)-(i/2);W.fillText(this.name,Y,X)};I.DrawImage=function(Y,ae,X){var af=this.tc,ab=this.x,Z=this.y,ag=this.sc,j=this.image,ac=this.w,W=this.h,aa=this.alpha,ad=this.shadow;Y.globalAlpha=aa;Y.setTransform(ag,0,0,ag,0,0);Y.fillStyle=this.colour;ad&&this.SetShadowColour(Y,ad,aa);ab+=(ae/ag)-(ac/2);Z+=(X/ag)-(W/2);Y.drawImage(j,ab,Z,ac,W)};I.DrawImageIE=function(Y,ac,X){var j=this.image,ad=this.sc,ab=j.width=this.w*ad,W=j.height=this.h*ad,aa=(this.x*ad)+ac-(ab/2),Z=(this.y*ad)+X-(W/2);Y.setTransform(1,0,0,1,0,0);Y.globalAlpha=this.alpha;Y.drawImage(j,aa,Z)};I.Calc=function(Y,X){var i=a(this.p3d,Y),j=this.tc,Z=j.minBrightness,W=j.radius;this.p3d=b(i,X);i=R(j,this.p3d,this.w,this.h,j.stretchX,j.stretchY);this.x=i.x;this.y=i.y;this.sc=(j.z1+j.z2-i.z)/j.z2;this.alpha=y(Z,U(1,Z+1-((i.z-j.z2+W)/(2*W))))};I.CheckActive=function(X,ab,W){var ac=this.tc,i=this.outline,aa=this.w,j=this.h,Z=this.x-aa/2,Y=this.y-j/2;i.Update(Z,Y,aa,j,this.sc,this.p3d,ab,W);return i.Active(X,ac.mx,ac.my)?i:null};I.Clicked=function(Z){var j=this.a,W=j.target,X=j.href,i;if(W!=""&&W!="_self"){if(self.frames[W]){self.frames[W]=X}else{try{if(top.frames[W]){top.frames[W]=X;return}}catch(Y){}window.open(X,W)}return}if(j.fireEvent){if(!j.fireEvent("onclick")){return}}else{i=k.createEvent("MouseEvents");i.initMouseEvent("click",1,1,window,0,0,0,0,0,0,0,0,0,0,null);if(!j.dispatchEvent(i)){return}}k.location=X};function r(){var j,W={mx:-1,my:-1,z1:20000,z2:20000,z0:0.0002,freezeActive:false,activeCursor:"pointer",pulsateTo:1,pulsateTime:3,reverse:false,depth:0.5,maxSpeed:0.05,minSpeed:0,decel:0.95,interval:20,initial:null,hideTags:true,minBrightness:0.1,outlineColour:"#ffff99",outlineThickness:2,outlineOffset:5,outlineMethod:"outline",textColour:"#ff99ff",textHeight:15,textFont:"Helvetica, Arial, sans-serif",shadow:"#000",shadowBlur:0,shadowOffset:[0,0],zoom:1,weight:false,weightMode:"size",weightFrom:null,weightSize:1,weightGradient:{0:"#f00",0.33:"#ff0",0.66:"#0f0",1:"#00f"},txtOpt:true,txtScale:2,frontSelect:false,wheelZoom:true,zoomMin:0.3,zoomMax:3,zoomStep:0.05,shape:"sphere",lock:null,tooltip:null,tooltipDelay:300,tooltipClass:"tctooltip",radiusX:1,radiusY:1,radiusZ:1,stretchX:1,stretchY:1,shuffleTags:false,noSelect:false,noMouse:false,imageScale:1};for(j in W){this[j]=W[j]}this.max_weight=0;this.min_weight=200}c=r.prototype;c.Draw=function(){var af=this.canvas,ad=af.width,W=af.height,j=0,ac=this.yaw,X=this.pitch,Y=ad/2,ai=W/2,ag=this.ctxt,aa,ah,ae,ab=-1,ak=this.taglist,Z=ak.length,aj=this.frontSelect;if(ac==0&&X==0&&this.drawn){return this.Animate(ad,W)}ag.setTransform(1,0,0,1,0,0);this.active=null;for(ae=0;ae<Z;++ae){ak[ae].Calc(ac,X)}ak=ak.sort(function(al,i){return al.sc-i.sc});for(ae=0;ae<Z;++ae){ah=ak[ae].CheckActive(ag,Y,ai);ah=this.mx>=0&&this.my>=0&&ak[ae].CheckActive(ag,Y,ai);if(ah&&ah.sc>j&&(!aj||ah.z<=0)){aa=ah;aa.index=ab=ae;j=ah.sc}}this.active=aa;if(!this.txtOpt&&this.shadow){ag.shadowBlur=this.shadowBlur;ag.shadowOffsetX=this.shadowOffset[0];ag.shadowOffsetY=this.shadowOffset[1]}ag.clearRect(0,0,ad,W);for(ae=0;ae<Z;++ae){if(!(ab==ae&&aa.PreDraw(ag,ak[ae],Y,ai))){ak[ae].Draw(ag,Y,ai)}ab==ae&&aa.PostDraw(ag)}if(this.freezeActive&&aa){this.yaw=this.pitch=this.drawn=0}else{this.Animate(ad,W);this.drawn=1}aa&&aa.LastDraw(ag);af.style.cursor=aa?this.activeCursor:"";this.Tooltip(aa,ak[ab])};c.TooltipNone=function(){};c.TooltipNative=function(j,i){this.canvas.title=j&&i.title?i.title:""};c.TooltipDiv=function(X,j){var i=this,W=i.ttdiv.style,Y=i.canvas.id;if(X&&j.title){i.ttdiv.innerHTML=j.title;if(W.display=="none"&&!i.tttimer){i.tttimer=setTimeout(function(){var Z=H(i.canvas).offset();W.display="block";W.left=Z.left+i.mx+"px";W.top=Z.top+i.my+24+"px";i.tttimer=null},i.tooltipDelay)}}else{W.display="none"}};c.Animate=function(ab,Y){var W=this,aa=W.mx,Z=W.my,j=W.lock,ad,ac,X,i;if(aa>=0&&Z>=0&&aa<ab&&Z<Y){ad=W.maxSpeed,i=W.reverse?-1:1;if(j!="x"){this.yaw=i*((ad*2*aa/ab)-ad)}if(j!="y"){this.pitch=i*-((ad*2*Z/Y)-ad)}this.initial=null}else{if(!W.initial){ad=W.minSpeed,ac=F(W.yaw),X=F(W.pitch);if(j!="x"&&ac>ad){this.yaw=ac>W.z0?W.yaw*W.decel:0}if(j!="y"&&X>ad){this.pitch=X>W.z0?W.pitch*W.decel:0}}}};c.Zoom=function(i){this.z2=this.z1*(1/i);this.drawn=0};c.Clicked=function(X){var W=this.taglist,i=this.active;try{if(i&&W[i.index]){W[i.index].Clicked(X)}}catch(j){}};c.Wheel=function(j){var W=this.zoom+this.zoomStep*(j?1:-1);this.zoom=U(this.zoomMax,y(this.zoomMin,W));this.Zoom(this.zoom)};r.tc={};jQuery.fn.tagcanvas=function(W,j){var i,X=j?jQuery("#"+j):this;if(k.all&&!j){return false}i=X.find("a");if(M(window.G_vmlCanvasManager)){this.each(function(){H(this)[0]=window.G_vmlCanvasManager.initElement(H(this)[0])});W.ie=parseFloat(navigator.appVersion.split("MSIE")[1])}if(!i.length||!this[0].getContext||!this[0].getContext("2d").fillText){return false}this.each(function(){var aa,Y,ac,af,ag,ab,ae,ad=[],Z={sphere:m,vcylinder:v,hcylinder:E};j||(i=H(this).find("a"));ab=new r;for(aa in W){ab[aa]=W[aa]}ab.z1=(19800/(Math.exp(ab.depth)*(1-1/Math.E)))+20000-19800/(1-(1/Math.E));ab.z2=ab.z1*(1/ab.zoom);ab.radius=(this.height>this.width?this.width:this.height)*0.33*(ab.z2+ab.z1)/(ab.z1);ab.yaw=ab.initial?ab.initial[0]*ab.maxSpeed:0;ab.pitch=ab.initial?ab.initial[1]*ab.maxSpeed:0;ab.canvas=H(this)[0];ab.ctxt=ab.canvas.getContext("2d");ab.textFont=ab.textFont&&s(ab.textFont);ab.pulsateTo*=1;ab.textHeight*=1;ab.minBrightness*=1;ab.ctxt.textBaseline="top";if(ab.shadowBlur||ab.shadowOffset[0]||ab.shadowOffset[1]){ab.ctxt.shadowColor=ab.shadow;ab.shadow=ab.ctxt.shadowColor;ab.shadowAlpha=u()}else{delete ab.shadow}ab.taglist=[];ab.shape=Z[ab.shape]||Z.sphere;Y=ab.shape(i.length,ab.radiusX,ab.radiusY,ab.radiusZ);ab.shuffleTags&&G(Y);for(aa=0;aa<i.length;++aa){ac=i[aa].getElementsByTagName("img");if(ac.length){af=new Image;af.src=ac[0].src;ag=new D(ab,af,i[aa],Y[aa],1,1);N(af,ac[0],ag,ab)}else{ab.taglist.push(new D(ab,i[aa].innerText||i[aa].textContent,i[aa],Y[aa],2,ab.textHeight+2,ab.textColour||L(i[aa],"color"),ab.textFont||s(L(i[aa],"font-family"))))}if(ab.weight){ae=w(ab,i[aa]);if(ae>ab.max_weight){ab.max_weight=ae}if(ae<ab.min_weight){ab.min_weight=ae}ad.push(ae)}}if(ab.weight=(ab.max_weight>ab.min_weight)){for(aa=0;aa<ab.taglist.length;++aa){ab.taglist[aa].SetWeight(ad[aa])}}r.tc[H(this)[0].id]=ab;ab.Tooltip=(ab.tooltip=="native"?ab.TooltipNative:(ab.tooltip?ab.TooltipDiv:ab.TooltipNone));if(ab.tooltip){if(ab.tooltip=="native"){ab.Tooltip=ab.TooltipNative}else{ab.Tooltip=ab.TooltipDiv;if(!ab.ttdiv){ab.ttdiv=k.createElement("div");ab.ttdiv.className=ab.tooltipClass;ab.ttdiv.style.position="absolute";ab.ttdiv.style.zIndex=ab.canvas.style.zIndex+1;z("mouseover",function(ah){ah.target.style.display="none"},ab.ttdiv);k.body.appendChild(ab.ttdiv)}}}else{ab.Tooltip=ab.TooltipNone}if(!ab.noMouse){z("mousemove",K,this);z("mouseout",h,this);z("mouseup",p,this);if(ab.wheelZoom){z("mousewheel",S,this);z("DOMMouseScroll",S,this)}}j&&ab.hideTags&&X.hide();W.interval=W.interval||ab.interval});return !!(r.started||(r.started=setInterval(n,W.interval)))}})(jQuery);
